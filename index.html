<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²è’‚å¤«çš„å•è¯è¾…åŠ©è®°å¿†ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #ec4899;
            --success: #10b981;
            --bg: #f8fafc;
            --text: #1e293b; /* åŠ æ·±æ–‡å­—é¢œè‰²æå‡è´¨æ„Ÿ */
            --card-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
            /* ç³»ç»Ÿé¡¶çº§å­—ä½“æ—ï¼Œå…¼é¡¾ä¸­è‹±ç¾æ„Ÿ */
            --font-main: "Inter", -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei UI", sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            /* å­—ä½“å¹³æ»‘æ¸²æŸ“ */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        header {
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            padding: 0.8rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            z-index: 100;
        }

        .brand-text { 
            font-weight: 800; 
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary)); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .nav-group button { 
            background: transparent; 
            color: #64748b; 
            padding: 0.6rem 1.2rem; 
            border-radius: 10px; 
            border: none; 
            cursor: pointer; 
            font-weight: 600; 
            transition: 0.2s;
        }
        .nav-group button.active { background: #eff6ff; color: var(--primary); }

        .score-badge { 
            background: #fff; 
            padding: 0.5rem 1.2rem; 
            border-radius: 14px; 
            font-weight: 800; 
            border: 2px solid #edf2f7; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.04);
        }

        main {
            flex-grow: 1;
            display: flex;
            align-items: center; 
            justify-content: center;
            width: 100%;
            padding: 1.5rem;
            box-sizing: border-box;
        }

        .box {
            width: 100%;
            max-width: 620px;
            height: 540px; 
            background: white;
            padding: 2.5rem;
            border-radius: 2.5rem;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* è®°å¿†å¡ç‰‡æ ¸å¿ƒ */
        .card-container {
            perspective: 1500px;
            width: 100%;
            height: 320px;
            margin-bottom: 2rem;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            transform-style: preserve-3d;
        }

        .flipped .card-inner { transform: rotateY(180deg); }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
        }

        .card-front { background: #fff; border: 1.5px solid #f1f5f9; }
        .card-front .word-text { font-size: 4rem; font-weight: 800; letter-spacing: -1.5px; color: var(--primary); }
        
        .card-back { background: linear-gradient(145deg, var(--primary), #6366f1); color: white; transform: rotateY(180deg); }
        .card-back .meaning-text { font-size: 2.6rem; font-weight: 600; letter-spacing: 2px; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* è¾“å…¥ä¸å½•å…¥ */
        textarea { 
            width: 100%; 
            flex: 1; 
            margin: 1.5rem 0;
            padding: 1.5rem; 
            border-radius: 1.2rem; 
            border: 2px solid #f1f5f9; 
            background: #f8fafc; 
            font-size: 1.1rem; 
            line-height: 1.6;
            color: var(--text);
            resize: none;
            outline: none;
        }
        textarea:focus { border-color: var(--primary); background: #fff; }
        
        input[type="text"] {
            width: 100%;
            padding: 1.2rem;
            font-size: 2rem;
            border-radius: 1.2rem;
            border: 2.5px solid #e2e8f0;
            text-align: center;
            margin-top: 1.5rem;
            outline: none;
            transition: 0.2s;
            font-weight: 600;
        }
        input[type="text"]:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }

        button { border: none; padding: 1rem 2rem; border-radius: 1.1rem; cursor: pointer; font-weight: 700; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 14px rgba(79, 70, 229, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4); }

        .quiz-title { color: #64748b; font-weight: 700; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; }
        .quiz-q-text { font-size: 3.4rem; font-weight: 800; margin: 0.8rem 0; letter-spacing: -1px; }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
        .hidden { display: none !important; }
        .flash-success { background-color: #ecfdf5 !important; }
    </style>
</head>
<body>

<canvas id="confetti-canvas"></canvas>

<header>
    <div>
        <div class="brand-text">STEVE WORDMEM PRO</div>
        <div class="nav-group">
            <button id="tab-setup" onclick="switchSection('setup')" class="active">è¯åº“</button>
            <button id="tab-learning" onclick="switchSection('learning')">è®°å¿†</button>
            <button id="tab-quiz" onclick="switchSection('quiz')">æµ‹è¯•</button>
        </div>
    </div>
    <div class="score-badge">ğŸ† <span id="score">0</span></div>
</header>

<main>
    <section id="setup" class="box">
        <div class="quiz-title">è¯åº“é…ç½®</div>
        <textarea id="word-input" placeholder="è¾“å…¥æ ¼å¼ å•è¯:é‡Šä¹‰">Focus: v. å…³æ³¨ï¼›èšç„¦  n. å…³æ³¨&#10;System:ç³»ç»Ÿ&#10;Design:è®¾è®¡&#10;Success:æˆåŠŸ</textarea>
        <button class="btn-primary" onclick="saveAndStart()" style="width:100%">ä¿å­˜å¹¶æ›´æ–°</button>
    </section>

    <section id="learning" class="box hidden">
        <div id="progress-text" style="position: absolute; top: 2rem; color: #94a3b8; font-weight: 800; font-size: 0.9rem;"></div>
        <div class="card-container" id="main-card" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front"><div class="word-text" id="card-word"></div></div>
                <div class="card-back"><div class="meaning-text" id="card-meaning"></div></div>
            </div>
        </div>
        <div style="display: flex; gap: 1rem; width: 100%;">
            <button onclick="prevCard()" style="flex: 1; background: #f1f5f9; color: #475569">ä¸Šä¸€ä¸ª</button>
            <button class="btn-primary" onclick="nextCard()" style="flex: 2;">ä¸‹ä¸€ä¸ªå•è¯</button>
        </div>
    </section>

    <section id="quiz" class="box hidden">
        <div id="quiz-container" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>
    </section>
</main>

<script>
    let words = [];
    let currentIndex = 0;
    let score = parseInt(localStorage.getItem('steveScore')) || 0;
	let lastQuizWord = null;
    document.getElementById('score').innerText = score;

    function switchSection(id) {
        if (words.length < 2 && id !== 'setup') return;
        document.querySelectorAll('.nav-group button').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-'+id).classList.add('active');
        ['setup', 'learning', 'quiz'].forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if(id === 'quiz') generateQuestion();
        if(id === 'learning') updateCard();
    }

	function saveAndStart() {
        const raw = document.getElementById('word-input').value;
        words = raw.split('\n').map(l => {
            // 1. æŒ‰ç…§ç¬¬ä¸€ä¸ªå†’å·åˆ†å‰²å•è¯å’Œè§£é‡Šå†…å®¹
            const splitIndex = l.indexOf(':');
            if (splitIndex === -1) return null;

            const word = l.substring(0, splitIndex).trim();
            let meaning = l.substring(splitIndex + 1).trim(); // å¿½ç•¥å†’å·åçš„ç©ºæ ¼

            // 2. å¤„ç†ç‚¹å·æ¢è¡Œï¼šå°†ä¸¤ä¸ªè¿ç»­ç‚¹å· .. æ›¿æ¢ä¸ºæ¢è¡Œç¬¦
            meaning = meaning.replace(/\.\./g, '<br>');

            // 3. å¤„ç†åŒç©ºæ ¼æ¢è¡Œï¼šå°†ä¸¤ä¸ªè¿ç»­ç©ºæ ¼æ›¿æ¢ä¸ºæ¢è¡Œç¬¦
            // è¿™æ · "v. è§£é‡Š  n. è§£é‡Š" å°±ä¼šå˜æˆä¸¤è¡Œ
            meaning = meaning.split('  ').join('<br>');

            return { w: word, m: meaning };
        }).filter(v => v);

        if (words.length < 2) return alert("è¯·è‡³å°‘å½•å…¥ä¸¤ä¸ªè¯");
        switchSection('learning');
    }

    function updateCard() {
        const item = words[currentIndex];
        document.getElementById('card-word').innerText = item.w;
        
        // ä½¿ç”¨ innerHTML ä»¥æ”¯æŒè§£ææˆ‘ä»¬æ’å…¥çš„ <br> æ ‡ç­¾
        document.getElementById('card-meaning').innerHTML = item.m;
        
        document.getElementById('progress-text').innerText = `${currentIndex + 1} / ${words.length}`;
        document.getElementById('main-card').classList.remove('flipped');
    }

    function nextCard() { currentIndex = (currentIndex + 1) % words.length; updateCard(); }
    function prevCard() { currentIndex = (currentIndex - 1 + words.length) % words.length; updateCard(); }

    function generateQuestion() {
        const container = document.getElementById('quiz-container');
		// å¢åŠ é˜²é‡å¤æŠ½å–é€»è¾‘
		let target;
		if (words.length > 1) {
			do {
				target = words[Math.floor(Math.random() * words.length)];
			} while (target === lastQuizWord); // å¦‚æœæŠ½åˆ°äº†è·Ÿä¸Šæ¬¡ä¸€æ ·çš„ï¼Œå°±é‡æŠ½
		} else {
			target = words[0];
		}
		// æ›´æ–°â€œä¸Šä¸€æ¬¡å•è¯â€çºªå½•
		lastQuizWord = target;
		
        const isChoice = Math.random() > 0.5;

        if (isChoice) {
            let opts = [target.m, ...words.filter(v => v.m !== target.m).map(v => v.m).sort(() => 0.5 - Math.random()).slice(0, 3)];
            opts.sort(() => 0.5 - Math.random());
            container.innerHTML = `
                <div class="quiz-title">Multiple Choice</div>
                <div class="quiz-q-text" style="color:var(--primary)">${target.w}</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.2rem;margin-top:1.5rem;width:100%">
                    ${opts.map(o => `<button class="score-badge" style="cursor:pointer;padding:1.4rem;font-size:1rem;border:2.5px solid #f1f5f9;line-height:1.4" onclick="checkAnswer(this.innerHTML.trim() === \`${target.m.replace(/"/g, '&quot;')}\`)">${o}</button>`).join('')}
                </div>`;
        } else {
            // æ‹¼å†™æ¨¡å¼ä¿æŒä¸å˜
            container.innerHTML = `
                <div class="quiz-title">Spelling Challenge</div>
                <div class="quiz-q-text" style="color:var(--text); font-size: 2.2rem; line-height: 1.3;">${target.m}</div>
                <input type="text" id="si" autocomplete="off" placeholder="Type here...">
                <p style="color:#94a3b8; margin-top:1.5rem; font-size:0.9rem; font-weight:600">PRESS ENTER TO CHECK</p>
            `;
            const i = document.getElementById('si'); i.focus();
            i.onkeydown = (e) => { if (e.key === 'Enter') checkAnswer(i.value.trim().toLowerCase() === target.w.toLowerCase()) };
        }
    }

    function checkAnswer(correct) {
        if(correct) {
            score += 10;
            document.getElementById('score').innerText = score;
            localStorage.setItem('steveScore', score);
            if(score % 100 === 0) fireConfetti();
            document.body.classList.add('flash-success');
            setTimeout(() => { document.body.classList.remove('flash-success'); generateQuestion(); }, 400);
        } else {
            document.body.style.background = '#fee2e2';
            setTimeout(() => document.body.style.background = '', 400);
        }
    }

    function fireConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let ps = Array.from({length:180}, () => ({
            x:canvas.width/2, y:canvas.height/2, d:Math.random()*Math.PI*2, s:Math.random()*12+6, 
            c:`hsl(${Math.random()*360}, 80%, 60%)`, sz:Math.random()*10+4, o:1
        }));
        function draw() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ps.forEach((p,i) => {
                p.x+=Math.cos(p.d)*p.s; p.y+=Math.sin(p.d)*p.s+3; p.o-=0.01;
                ctx.fillStyle=p.c; ctx.globalAlpha=p.o; ctx.fillRect(p.x,p.y,p.sz,p.sz);
                if(p.o<=0) ps.splice(i,1);
            });
            if(ps.length>0) requestAnimationFrame(draw);
        }
        draw();
    }
</script>
</body>
</html>